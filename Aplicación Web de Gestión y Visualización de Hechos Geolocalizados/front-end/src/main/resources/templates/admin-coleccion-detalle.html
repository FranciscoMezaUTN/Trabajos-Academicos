<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle de Colección - MetaMapa Admin</title>

    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/hecho.css}">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<div class="admin-layout">
    <aside class="sidebar">
        <a th:href="@{/}" class="logo">MetaMapa Admin</a>
        <nav class="sidebar__nav">
            <a th:href="@{/admin/dashboard}" class="sidebar__link">Dashboard</a>
            <a th:href="@{/admin/colecciones}" class="sidebar__link sidebar__link--active">Colecciones</a>
            <a th:href="@{/admin/revisiones}" class="sidebar__link">Revisiones</a>
            <a th:href="@{/admin/estadisticas}" class="sidebar__link">Estadísticas </a>
        </nav>
        <a th:href="@{/auth/logout}" class="btn btn--secondary sidebar__logout">Cerrar Sesión</a>
    </aside>

    <div class="main-content">
        <div class="detail-container">

            <div th:if="${mensaje}" class="api-success-alert mb-2">
                <span th:text="${mensaje}"></span>
            </div>

            <h1 class="page-title">Gestión de Colecciones</h1>

            <div class="stat-card">

                <div style="margin-bottom: 20px;">
                    <h1 class="section-title" style="margin-top: 5px;" th:text="${coleccion.titulo}">Nombre de la Colección</h1>
                </div>

                <div class="content-block">
                    <h3 class="content-title">Descripción</h3>
                    <p th:text="${coleccion.descripcion}" style="color: #334155; line-height: 1.6;">Desc...</p>
                </div>

                <div class="content-block">
                    <h3 class="content-title">Fuentes Asociadas</h3>

                    <div th:if="${not #lists.isEmpty(coleccion.fuentes)}" style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <span th:each="fuente : ${coleccion.fuentes}"
                              class="tag-pill"> <span th:text="${fuente.nombre != null ? fuente.nombre : fuente}">Fuente</span>
                        </span>
                    </div>

                    <p th:if="${#lists.isEmpty(coleccion.fuentes)}" style="color: #94a3b8; font-style: italic;">
                        Sin fuentes vinculadas.
                    </p>
                </div>

                <div class="content-block">
                    <h3 class="content-title">Algoritmo de Consenso</h3>
                    <div th:if="${coleccion.algoritmoConsenso}" class="code-box"> <span th:text="${coleccion.algoritmoConsenso}"></span>
                    </div>
                    <p th:if="${coleccion.algoritmoConsenso == null}" style="color: #94a3b8; font-style: italic;">
                        No definido (Manual).
                    </p>
                </div>

                <div class="content-block" style="border-bottom: none; padding-bottom: 0;">
                    <h3 class="content-title">Criterios de Pertenencia</h3>

                    <div th:if="${not #lists.isEmpty(coleccion.criteriosDePertenencias)}">
                        <div th:each="criterio : ${coleccion.criteriosDePertenencias}" class="criterio-card">

                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-weight: 600; color: #1e293b;" th:text="${criterio.nombreCriterio}">Nombre</span>
                                <span class="badge-criterio" th:text="${criterio.tipoCriterio}">TIPO</span>
                            </div>

                            <div class="param-grid">

                                <th:block th:if="${#strings.toString(criterio.tipoCriterio) == 'FECHA'}">
                                    <div class="param-item">
                                        <span class="param-label">Desde</span>
                                        <span th:text="${criterio.parametros['FECHAINICIO'] ?: criterio.parametros['fechaInicio']}"></span>
                                    </div>
                                    <div class="param-item">
                                        <span class="param-label">Hasta</span>
                                        <span th:text="${criterio.parametros['FECHAFIN'] ?: criterio.parametros['fechaFin']}"></span>
                                    </div>
                                </th:block>

                                <th:block th:if="${#strings.toString(criterio.tipoCriterio) == 'CATEGORIA'}">
                                    <div class="param-item">
                                        <span class="param-label">Categoría</span>
                                        <span th:text="${criterio.parametros['CATEGORIA'] ?: criterio.parametros['categoria']}"></span>
                                    </div>
                                </th:block>

                                <th:block th:if="${#strings.toString(criterio.tipoCriterio) != 'FECHA' and #strings.toString(criterio.tipoCriterio) != 'CATEGORIA'}">
                                    <div class="param-item" th:each="entry : ${criterio.parametros}">
                                        <span class="param-label" th:text="${entry.key}">Clave</span>
                                        <span th:text="${entry.value}">Valor</span>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                    </div>

                    <p th:if="${#lists.isEmpty(coleccion.criteriosDePertenencias)}" style="color: #94a3b8; font-style: italic;">
                        Sin criterios definidos.
                    </p>
                </div>

                <div class="form-actions">
                    <a th:href="@{/hechos/mapa/coleccion/{id}(id=${coleccion.id})}"
                       target="_blank"
                       class="btn btn--secondary"
                       style="display: inline-flex; align-items: center; gap: 8px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon><line x1="8" y1="2" x2="8" y2="18"></line><line x1="16" y1="6" x2="16" y2="22"></line></svg>
                        Ver en Mapa
                    </a>

                    <a th:href="@{/admin/colecciones/{id}/editar(id=${coleccion.id})}" class="btn btn--primary">
                        Editar Colección
                    </a>

                    <a th:href="@{/admin/colecciones/{id}/eliminar(id=${coleccion.id})}"
                       class="btn btn--third"
                       onclick="return confirm('¿Estás seguro de eliminar esta colección? Esta acción es irreversible.')">
                        Eliminar Colección
                    </a>
                </div>

            </div>
        </div>
    </div>
</div>
</body>
</html>