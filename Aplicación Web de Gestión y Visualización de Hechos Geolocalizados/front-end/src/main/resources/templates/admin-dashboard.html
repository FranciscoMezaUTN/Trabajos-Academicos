<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MetaMapa Admin</title>
    <link rel="stylesheet" th:href="@{/css/global.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>

<body>
<div class="admin-layout">
    <!-- Sidebar con enlaces din치micos -->
    <aside class="sidebar">
        <a th:href="@{/}" class="logo">MetaMapa Admin</a>
        <nav class="sidebar__nav">
            <a th:href="@{/admin/dashboard}" class="sidebar__link sidebar__link--active">Dashboard</a>
            <a th:href="@{/admin/colecciones}" class="sidebar__link">Colecciones</a>
            <a th:href="@{/admin/revisiones}" class="sidebar__link">Revisiones</a>
            <a th:href="@{/admin/estadisticas}" class="sidebar__link">Estad칤sticas </a>
        </nav>
        <a th:href="@{/auth/logout}" class="btn btn--secondary sidebar__logout">Cerrar Sesi칩n</a>
    </aside>

    <main class="main-content">
        <h1 class="page-title">Panel de Control</h1>

        <!-- Mensajes de feedback (칠xito/error) -->
        <div th:if="${mensaje}" class="api-success-alert mt-2 mb-2" th:text="${mensaje}"></div>
        <div th:if="${error}" class="api-error-alert mt-2 mb-2" th:text="${error}"></div>

        <!-- Tarjetas de estad칤sticas din치micas -->
        <div class="dashboard-grid">
            <div class="stat-card">
                <h3 class="stat-card__title">Hechos Pendientes</h3>
                <p class="stat-card__number" th:text="${summary.hechosPendientes}">0</p>
            </div>
            <div class="stat-card">
                <h3 class="stat-card__title">Solicitudes de Eliminaci칩n</h3>
                <p class="stat-card__number" th:text="${summary.solicitudesEliminacion}">0</p>
            </div>
            <div class="stat-card">
                <h3 class="stat-card__title">Solicitudes de Modificaci칩n</h3>
                <p class="stat-card__number" th:text="${summary.solicitudesModificacion}">0</p>
            </div>
            <div class="stat-card">
                <h3 class="stat-card__title">Colecciones Activas</h3>
                <p class="stat-card__number" th:text="${summary.coleccionesActivas}">0</p>
            </div>
        </div>

        <!-- Secci칩n de Actividad Reciente -->
        <div class="recent-activity">

            <!-- Header flexible para t칤tulo y bot칩n -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="section-title" style="margin-bottom: 0;">Actividad Reciente</h2>

                <button onclick="document.getElementById('modal-importar').style.display='flex'" class="btn btn--primary">
                    游닌 Importar Hechos (CSV)
                </button>
            </div>

            <!-- Lista din치mica de Actividad -->
            <div class="activity-list" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden;">

                <div th:if="${actividadReciente == null || #lists.isEmpty(actividadReciente)}"
                     style="padding: 20px; text-align: center; color: #666; background: #fff;">
                    No hay actividad reciente registrada.
                </div>

                <!-- Bucle de renderizado por item -->
                <div th:each="item : ${actividadReciente}" class="activity-item"
                     style="padding: 15px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 15px; background: #fff;">

                    <div class="activity-icon" style="flex-shrink: 0;">
                        <!-- 칈conos basados en el campo 'tipo' -->
                        <span th:if="${item.tipo == 'NUEVO_HECHO'}" style="font-size: 1.5em; color: #3b82f6;">游늯</span>
                        <span th:if="${item.tipo == 'SOLICITUD_BAJA'}" style="font-size: 1.5em; color: #ef4444;">丘멆잺</span>
                        <span th:if="${item.tipo == 'SOLICITUD_MODIFICACION'}" style="font-size: 1.5em; color: #f97316;">九勇</span>
                        <span th:if="${item.tipo == 'NUEVA_COLECCI칍N'}" style="font-size: 1.5em; color: #10b981;">游닄</span>
                    </div>

                    <div class="activity-details" style="flex-grow: 1;">
                        <p class="activity-title" style="margin: 0; font-weight: 600; line-height: 1.4;">
                            <span th:text="${item.accion}">Acci칩n</span>:
                            <span th:text="${item.tituloHecho}" style="font-weight: 400; color: #333;">T칤tulo</span>
                        </p>
                        <p class="activity-meta" style="margin: 5px 0 0 0; font-size: 0.85rem; color: #666;">
                            <span th:text="${item.autor}" style="font-weight: 500;">Autor</span> &bull;
                            <span th:text="${#temporals.format(item.fecha, 'dd/MM/yyyy HH:mm')}">Fecha</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Importaci칩n (Oculto por defecto) -->
        <div id="modal-importar" class="modal"
             style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:1000;">
            <div class="modal-content" style="background:white; padding:30px; border-radius:8px; width:400px; position:relative;">

                <span onclick="document.getElementById('modal-importar').style.display='none'"
                      style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:1.5rem;">&times;</span>

                <h2 style="margin-bottom:20px;">Importar Hechos</h2>

                <form th:action="@{/admin/importar-hechos}" method="post" enctype="multipart/form-data">
                    <div class="form-group" style="margin-bottom:20px;">
                        <label for="csvFile" style="display:block; margin-bottom:10px;">Seleccion치 el archivo .csv</label>
                        <input type="file" id="csvFile" name="archivoCsv" accept=".csv" class="form-control" required>
                    </div>

                    <div style="text-align:right;">
                        <button type="button" onclick="document.getElementById('modal-importar').style.display='none'" class="btn btn--secondary">Cancelar</button>
                        <button type="submit" class="btn btn--primary">Subir</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>
</body>
</html>